<!-- close-deletion-form-floating-card +8g from it is -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DietMaster - Meal Recommendation System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="account2.css">
    <link rel="stylesheet" href="updateforms.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    

    <style>
        /* Card styles */
  #confirmation-card{
     background-color: transparent;
     padding: 14px;
  }      
 .card-container {
   
   background: transparent;
     border: 1px solid transparent;
     border-radius: 8px;
     padding: 16px;
     margin: 20px auto;
     width: 100%;
     box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
     text-align: center;
 }
 
 .card-title {
     font-size: 18px;
     font-weight: bold;
     /* color: lightseagreen; */
     margin-bottom: 16px;
     border-bottom: solid 1pt lightgray;
     padding-bottom: 10px;
 }
 
 #details-list .detail-card {
     display: flex;
     justify-content: space-between;
     align-items: center;
     /* background: #343434; */
     border: 1px solid transparent;
     border-radius: 6px;
     padding: 12px 16px;
     /* color: white; */
     margin: 8px 0;
     box-shadow: 0 2px 4px rgb(202, 240, 240);
 }
 
 .card-actions {
   display: flex;
   justify-content: space-between;
   margin-top: 1rem;
 }
 
 .submit-btn {
   padding: 10px 20px;
   background: lightseagreen;
   color: white;
   border: none;
   border-radius: 5px;
   cursor: pointer;
 }
 
 .cancel-btn {
   padding: 10px 20px;
   background: rgb(129, 4, 4);
   color: white;
   border: none;
   border-radius: 5px;
   cursor: pointer;
 }
 
 .submit-btn:hover {
   background: rgb(2, 251, 234);
   color: black;
 }
 
 .cancel-btn:hover {
   background: red;
   color: black;
 }
 /* Responsive design */
 @media (max-width: 600px) {
   .card-container {
     padding: 10px;
   }
 
   .btn {
     font-size: 0.9rem;
     padding: 8px 16px;
   }
 }
 
 
 /* Responsive adjustments */
 @media (max-width: 600px) {
   .card-container {
     padding: 10px;
   }
 
   .btn {
     font-size: 0.9rem;
     padding: 8px 16px;
   }
 }
 
 
 /* floating card styles */
 
   
 .floating-card {
   position: fixed;
   top: 20px;
   right: 20px;
   padding: 15px 20px;
   border-radius: 8px;
   /* color: white; */
   font-size: 16px;
   display: flex;
   align-items: center;
   gap: 10px;
   z-index: 1000;
   opacity: 0;
   transform: translateY(50px);
   animation: fadeInUp 0.5s forwards;
   box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
 }
 
 .floating-card.error {
   background-color: #f1d8d5;
   color: red;
 }
 
 .floating-card.success {
   background-color: #2ecc71;
   color: white;
 }
 
 .card-icon {
   width: 24px;
   height: 24px;
 }
 
 .card-message {
   flex-grow: 1;
 }
 
 .close-btn {
   font-size: 20px;
   cursor: pointer;
   color: black;
   padding-left: 10px;
 }
 
 .close-btn:hover {
   color: #ccc;
 }
 
 /* Animation for card appearance */
 @keyframes fadeInUp {
   from {
     opacity: 0;
     transform: translateY(50px);
   }
   to {
     opacity: 1;
     transform: translateY(0);
   }
 }
 
 
 /* Loading Overlay */
 .loading-overlay {
   display: none; /* Hidden by default */
   position: fixed;
   top: 0;
   left: 0;
   width: 100%;
   height: 100%;
   background: rgba(0, 0, 0, 0.612);
   z-index: 1000;
   align-items: center;
   justify-content: center;
 }
 
 .loading-overlay.active {
   display: flex;
 }
 
 .spinner {
   border: 4px solid white;
   border-top: 4px solid black;
   border-radius: 50%;
   width: 40px;  
   height: 40px;
   animation: spin 1s linear infinite;
 }
 
 @keyframes spin {
   0% { transform: rotate(0deg); }
   100% { transform: rotate(360deg); }
 }
 
     </style>
</head>
<body>
    <!-- Navbar -->
    <nav>
        <div class="logo-container">
            <div class="logo">N</div>
            <div class="company-name">DietMaster</div>
        </div>
        <div class="nav-links">
            <a href="#" class="active">Dashboard</a>
            <a href="#">Meal Plans</a>
            <a href="/analysis">Analysis</a>
            <a href="#">About</a>
            <a href="#">Contact</a>
        </div>
        <div class="profile-nav">
            <div class="profile-image">
                <span id="navinitials"></span>
            </div>
        </div>
        <div class="hamburger" id="menu-toggle">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </nav>

    <!-- Profile Sidebar Toggle Button -->
    <div class="profile-toggle" id="profile-toggle">
        <span>‚â°</span>
    </div>

    <!-- Main Container -->
<!-- recommendation error -->

  <div id="loading-overlay" class="loading-overlay">Please wait...
    <div class="spinner"></div>
  </div>
    <div class="container">
        <!-- Profile Sidebar -->
        <div class="profile-sidebar" id="profile-sidebar">
            <div class="profile-header">
                <div class="profile-pic">
                    <span id="dpinnitials"></span>
                </div>
                
                <h2 class="profile-name" id="dashboard-heading">Loading...</h2>
                <p class="profile-email" id="emailContent">Loading...</p>
            </div>
            
            <div class="sidebar-links">
                <div class="sidebar-link active" style="background-color: lightgray; border-radius: 7px;">
                    <i>üìä</i>
                    <span>Dashboard</span>
                </div>
                <div class="sidebar-link" id = "tutionpayment">
                    <i>üçΩÔ∏è</i>
                    <span>Update Data</span>
                </div>
                <div class="sidebar-link">
                  <i>üìã</i>
                  <span>Favorites</span>
                  <div class="section-content" id="favoritemealsContent">
                      <p>Here are your favorite meals and dietary preferences.</p>
                  </div>
              </div>
              <div class="sidebar-link">
                  <i>üìà</i>
                  <span>Alergies</span>
                  <div class="section-content" id="allergiesContent">
                      <p>Information about your allergies and food sensitivities.</p>
                  </div>
              </div>
              <div class="sidebar-link">
                  <i>üìã</i>
                  <span>Health Conditions</span>
                  <div class="section-content" id="healthconditionContent">
                      <p>Details about your health conditions and special requirements.</p>
                  </div>
              </div>
              <div class="sidebar-link">
                  <i>üìà</i>
                  <span>Current Age</span>
                  <div class="section-content" id="ageContent">
                      <p>Your current age and age-related dietary recommendations.</p>
                  </div>
              </div>
                <div class="sidebar-link" id="dataclearing">
                    <i>üöÆ</i>
                    <span>Clear Data</span>
                </div>
            </div>
            <div class="logout-btn"  id="logout">
                <i>üö™</i>
                <span>Logout</span>
            </div>
        </div>

        <!-- Main All -->
        <div class="main-content">
          
            <div id="confirmation-card">
                <div class="card-container">
                  <h2 class="card-title">You are about to update below details for your child</h2>
                  <div id="details-list"></div>
                  <div class="card-actions">
                    <button id="submit-details" class="submit-btn">Confirm and Update</button>
                    <button id="cancel-details" class="cancel-btn">Cancel</button>
                  </div>
                </div>
              </div>
          
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>DietMaster</h3>
                    <p>Your personalized meal recommendation system for healthier eating habits and nutritional goals.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#">Dashboard</a></li>
                        <li><a href="#">Meal Plans</a></li>
                        <li><a href="#">Recipes</a></li>
                        <li><a href="#">Nutrition Facts</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Support</h3>
                    <ul class="footer-links">
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Newsletter</h3>
                    <p>Subscribe to our newsletter for nutrition tips and updates.</p>
                    <form class="search-form">
                        <input type="email" class="search-input" placeholder="Your email">
                        <button type="submit" class="search-btn">‚Üí</button>
                    </form>
                </div>
            </div>
            <div class="footer-bottom">
                <p>¬© 2025 DietMaster (Mackachila). All rights reserved.</p>
            </div>
        </div>
    </footer>
    <script src="account.js"></script> 
    <script src="dashboard.js"></script> 

    <script>

        const loadingOverlay = document.getElementById("loading-overlay");
        
        window.addEventListener('DOMContentLoaded', () => {
          const params = new URLSearchParams(window.location.search);
          const allergies = params.get('allergies');
          const health = params.get('health');
          const favorites = params.get('favorites');
          const age = params.get('age');
        
          // Check if the parameters exist
          if (!allergies || !health || !favorites || !age) {
            window.location.href = '/dashboard'; // Redirect to the dashboard if data is missing
            return;
          }
        
          const detailsList = document.getElementById('details-list');
          detailsList.innerHTML = `
            ${allergies ? `<div class="detail-card">Allergies:<b>${allergies}</b></div>` : ''}
            ${health ? `<div class="detail-card">Health Conditions:<b> ${health}</b></div>` : ''}
            ${favorites ? `<div class="detail-card">Favorite Meals:<b> ${favorites}</b></div>` : ''}
            ${age ? `<div class="detail-card">Child Age:<b> ${age}</b></div>` : ''}
          `;
          
          // Submit details and send to the server
          document.getElementById('submit-details').addEventListener('click', async () => {
            
            showLoadingSpinner();
            try {
              const response = await fetch('/update-details', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({ allergies, health, favorites, age })
              });
        
              const data = await response.json();
              if (response.ok) {
                displayFloatingCard(data.message, 'success');
                setTimeout(() => {
                  window.history.back();
          }, 5000);
                // Go back to the previous page
              // hideLoadingSpinner();
                // alert(data.message); // Show success message
              } else {
                displayFloatingCard(data.message, 'error');
                // alert(data.error); // Show error message
              }
            } catch (error) {
              console.error('Error:', error);
              // alert('An error occurred while submitting the details. Please try again later.');
              displayFloatingCard(data.message, 'error');
            }
            hideLoadingSpinner();
          });
        
          // Handle cancel button (clear URL parameters and go back)
          document.getElementById('cancel-details').addEventListener('click', () => {
            alert('Submission Cancelled!');
            const urlWithoutParams = window.location.origin + window.location.pathname;
            window.history.replaceState(null, '', urlWithoutParams); // Clear URL parameters
            window.history.back(); // Go back to the previous page
          });
        });
        
        
        
        // loading spinner
        
        function showLoadingSpinner() {
            loadingOverlay.classList.add('active');
          }
          
          function hideLoadingSpinner() {
            loadingOverlay.classList.remove('active');
          }
        
        function displayFloatingCard(message, type) {
          const card = document.createElement('div');
          card.className = `floating-card ${type}`;
          
          const icon = document.createElement('img');
          icon.className = 'card-icon';
          
          if (type === 'error') {
            icon.src = 'error.png';  // Assuming error.png is in the same directory
          } else if (type === 'success') {
            icon.src = 'tick.png';  // Assuming success.png is in the same directory
          }
        
          const text = document.createElement('span');
          text.className = 'card-message';
          text.textContent = message;
        
          const closeBtn = document.createElement('span');
          closeBtn.className = 'close-btn';
          closeBtn.textContent = '‚úï';
          closeBtn.onclick = () => {
            card.remove();
          };
        
          card.appendChild(icon);
          card.appendChild(text);
          card.appendChild(closeBtn);
          
          document.body.appendChild(card);
        
          // Automatically remove the card after 3 seconds
          setTimeout(() => {
            card.remove();
          }, 4000);
        }
        
        </script>

</body>
</html>