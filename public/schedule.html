<!-- close-deletion-form-floating-card +8g from it is -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DietMaster - Meal Recommendation System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="account2.css">
    <link rel="stylesheet" href="updateforms.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    

    <style>
        /* Schedule a meal section styling */
        h4 {
          color: #2c3e50;
          font-size: 20px;
          margin-bottom: 15px;
          padding-bottom: 8px;
          border-bottom: 2px solid #eaeaea;
        }
        
        #scheduleMealForm {
          background: white;
          padding: 20px;
          border-radius: 10px;
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
          margin-bottom: 25px;
        }
        
        #scheduleMealForm label {
          display: block;
          margin-bottom: 8px;
          font-weight: 500;
          color: #333;
        }
        
        #scheduleMealForm select,
        #scheduleMealForm input {
          width: 100%;
          padding: 12px;
          margin-bottom: 15px;
          border: 1px solid #ddd;
          border-radius: 5px;
          font-size: 14px;
          transition: border-color 0.3s;
        }
        
        #scheduleMealForm select:focus,
        #scheduleMealForm input:focus {
          outline: none;
          border-color: #4361ee;
          box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        #mealbutton {
          background-color: #4CAF50;
          color: white;
          border: none;
          border-radius: 5px;
          padding: 12px 20px;
          font-weight: 500;
          cursor: pointer;
          transition: background-color 0.3s;
          width: 100%;
        }
        
        #mealbutton:hover {
          background-color: transparent;
          border: solid 1pt #4CAF50;
          color: black;
        }
        /* Upcoming meals list styling */
        #mealList {
          background: white;
          padding: 15px 20px;
          border-radius: 10px;
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
          list-style-type: none;
          margin: 0;
        }
        
        #mealList li {
          padding: 12px 0;
          border-bottom: 1px solid #eaeaea;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }
        
        #mealList li:last-child {
          border-bottom: none;
        }
        
        #mealList li .meal-name {
          font-weight: 500;
          color: #333;
        }
        
        #mealList li .meal-date {
          color: #666;
          font-size: 14px;
        }
        
        #mealList li .meal-type {
          background-color: #e9ecef;
          padding: 4px 8px;
          border-radius: 4px;
          font-size: 12px;
          text-transform: capitalize;
        }
        
        /* Empty state */
        #mealList:empty::after {
          content: "No upcoming meals scheduled";
          display: block;
          text-align: center;
          color: #999;
          padding: 20px 0;
          font-style: italic;
        }
        
        /* Responsive adjustments */
        @media (min-width: 768px) {
          #scheduleMealForm {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
          }
          
          #scheduleMealForm label:first-child {
            grid-column: 1;
          }
          
          #mealbutton {
            grid-column: 1 / span 2;
            margin-top: 10px;
          }
        }
      </style>
</head>
<body>
    <!-- Navbar -->
    <nav>
        <div class="logo-container">
            <div class="logo">
              
                <img src="logo.png" alt="Logo">
           
            </div>
            <div class="company-name">DietMaster</div>
        </div>
        <div class="nav-links">
            <a href="/account" class="active">Meal Plans</a>
            <a href="/add_meal">Add Meal</a>
            <a href="/analysis">Analysis</a>
            <a href="/reports">Reports</a>
            <a href="/home#about">About</a>
            <a href="home#contact">Contact</a>
        </div>
        <div class="profile-nav">
            <div class="profile-image">
                <span id="navinitials"></span>
            </div>
        </div>
        <div class="hamburger" id="menu-toggle">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </nav>

    <!-- Profile Sidebar Toggle Button -->
    <div class="profile-toggle" id="profile-toggle">
        <span>‚â°</span>
    </div>

    <!-- Main Container -->
<!-- recommendation error -->

<div id="recommend-floating-card" class="hidden">
    <b id="close-card-btn">X</b>
      <img src="error.png" alt="Error" class="error-image">
    <p id="recommend-floating-card-message"></p>
  </div>

  <!-- Loading spinner and overlay configurations -->
    <div id="loading-overlay" class="loading-overlay">Getting Recommendation. Please wait...
      <div class="spinner"></div>
    </div>
    <div class="container">
        <!-- Profile Sidebar -->
        <div class="profile-sidebar" id="profile-sidebar">
            <div class="profile-header">
                <div class="profile-pic">
                    <span id="dpinnitials"></span>
                </div>
                
                <h2 class="profile-name" id="dashboard-heading">Loading...</h2>
                <p class="profile-email" id="emailContent">Loading...</p>
                <p class="profile-email" id="contactContent">Loading...</p>
            </div>
            
            <div class="sidebar-links">
                <div class="sidebar-link active" style="background-color: lightgray; border-radius: 7px;">
                    <i>üìä</i>
                    <span>Dashboard</span>
                </div>
                
                <div class="sidebar-link">
                  <i>üç¥</i>
                  <span>Favorites</span>
                  <div class="section-content" id="favoritemealsContent">
                      <p>Here are your favorite meals and dietary preferences.</p>
                  </div>
              </div>
              <div class="sidebar-link">
                  <i>ü¶†</i>
                  <span>Alergies</span>
                  <div class="section-content" id="allergiesContent">
                      <p>Information about your allergies and food sensitivities.</p>
                  </div>
              </div>
              <div class="sidebar-link">
                  <i>‚öïÔ∏è</i>
                  <span>Health Conditions</span>
                  <div class="section-content" id="healthconditionContent">
                      <p>Details about your health conditions and special requirements.</p>
                  </div>
              </div>
              <div class="sidebar-link">
                  <i>üçº</i>
                  <span>Current Age</span>
                  <div class="section-content" id="ageContent">
                      <p>Your current age and age-related dietary recommendations.</p>
                  </div>
              </div>
                
            </div>
            <div class="logout-btn"  id="logout">
                <i>üö™</i>
                <span>Logout</span>
            </div>
        </div>

        <!-- Main All -->
        <div class="main-content">
            <div class="section-title">
                <span>Plan yourself with DietMaster</span>
                   </div>
            
                   <div id="funny-section-wrapper">
                    <div class="hidden" style="display: none;"><b style="font-size: 20px;">Hello üëã<b id="timingusername"> Loading...</b></b>,<div id="time-message">Would you like to schedule some meals for future?</div></div>
                    <div id="date-today"></div>
                    <br>
                    <!-- <h2 class="funny-section-heading">Welcome to DietMasetr! We are here for your Kid's Diet</h2> -->
                    <h4>Schedule a meal for the future</h4>
                    <form id="scheduleMealForm">
                        <label>Meal Type:</label>
                        <select id="mealType">
                            <option value="" disabled selected>Select meal</option>
                            <option value="breakfast">Breakfast</option>
                            <option value="lunch">Lunch</option>
                            <option value="dinner">Dinner</option>
                            <option value="supper">Supper</option>
                        </select>
                    
                        <label>Meal Name:</label>
                        <input type="text" id="mealName" placeholder="e.g., Sima with Fish">
                    
                        <label>Date:</label>
                        <input type="date" id="mealDate">
                    
                        <button type="submit" id="mealbutton">Schedule Now</button>
                    </form>
                    
                <br>
                    <h4>My Upcoming Meals</h4>
                    <ul id="mealList"></ul>
                  
          </div>
    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>NutriMeal</h3>
                    <p>Your personalized meal recommendation system for healthier eating habits and nutritional goals.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#">Dashboard</a></li>
                        <li><a href="#">Meal Plans</a></li>
                        <li><a href="#">Recipes</a></li>
                        <li><a href="#">Nutrition Facts</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Support</h3>
                    <ul class="footer-links">
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Newsletter</h3>
                    <p>Subscribe to our newsletter for nutrition tips and updates.</p>
                    <form class="search-form">
                        <input type="email" class="search-input" placeholder="Your email">
                        <button type="submit" class="search-btn">‚Üí</button>
                    </form>
                </div>
            </div>
            <div class="footer-bottom">
                <p>¬© 2025 NutriMeal. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="account.js"></script> 
    <!-- <script src="script.js"></script> -->
    

    <script>

        // Get today's date in YYYY-MM-DD format
        const today = new Date().toISOString().split('T')[0];
      
      // Set the min attribute to today's date
      const mealDate = document.getElementById("mealDate");
      mealDate.setAttribute("min", today);
      
      </script>
<script>
document.getElementById("scheduleMealForm").addEventListener("submit", function (e) {
    e.preventDefault();
    
    
    let mealType = document.getElementById("mealType").value;
    let mealName = document.getElementById("mealName").value;
    let mealDate = document.getElementById("mealDate").value;

    if (!mealType || !mealName || !mealDate) {
        alert("Please fill all fields!");
        return;
    }

    fetch("/schedule-meals", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ meal_date: mealDate, meal_type: mealType, meal_name: mealName })
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message);
        fetchMeals(); // üî• Calls fetchMeals() after a successful request
    })
    .catch(error => console.error("Error:", error));
});

 </script>

      <script>
        async function fetchMeals() {
   
    try {
        const response = await fetch("/scheduled-meals"); // Request scheduled meals
        const meals = await response.json();
        
        console.log("Meals received:", meals); // Debug log to check data

        const mealList = document.getElementById("mealList");
        mealList.innerHTML = ""; // Clear previous meal list

        if (meals.length === 0) {
            console.log("No meals found.");
            mealList.innerHTML = "<li>No meals scheduled yet.</li>";
            return;
        }

        meals.forEach(meal => {
            const li = document.createElement("li");
            const mealDate = new Date(meal.meal_date).toLocaleDateString(); // Format date
            li.innerHTML = `${mealDate} - ${meal.meal_type}: ${meal.meal_name} 
                            <button onclick="deleteMeal(${meal.id})">Cancel ‚ùå</button>`;
            mealList.appendChild(li);
        });

        console.log("Meals successfully appended!");
    } catch (error) {
        console.error("Error fetching meals:", error);
    }
}


document.addEventListener("DOMContentLoaded", function () {
    fetchMeals(); // Fetch scheduled meals when the page loads
});

      </script>
      <script>

async function deleteMeal(mealId) {
    if (!confirm("Are you sure you want to cancel this meal?")) return;

    try {
        const response = await fetch("/delete-scheduled-meal", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ meal_id: mealId })
        });

        const data = await response.json();
        alert(data.message);

        if (response.ok) {
            fetchMeals(); // Refresh the meal list after deletion
        }
    } catch (error) {
        console.error("Error deleting meal:", error);
    }
}

      </script>
<!-- <script src="dashboard.js"></script> -->
<script src="account.js"></script>
</body>
</html>